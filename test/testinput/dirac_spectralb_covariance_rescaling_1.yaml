geometry:
  function space: NodeColumns
  grid:
    name: CS-LFR-12
  partitioner: cubedsphere
  groups:
  - variables: &vars
    - mu
    - unbalanced_pressure_levels_minus_one
    levels: 2
  halo: 1

background:
  date: 2010-01-01T12:00:00Z
  state variables: *vars

increment variables: *vars

background error:
  covariance model: SABER
  saber central block:
    saber block name: Hybrid
    components:
    - weight:
        value: 1.0
      covariance:
        saber central block:
          saber block name: spectral covariance
          active variables: *vars
          read:
            covariance_file: testdata/spectralcov.nc
            umatrix_netcdf_names:
            - MU_inc_Uv_matrix
            - aP_inc_Uv_matrix
        saber outer blocks:
        - saber block name: spectral to gauss
        - saber block name: gauss to cubed-sphere-dual
          gauss grid uid: F12
          rescaling:
            horizontal covariance profile file path: testdata/dirac_spectralb_covariance_profiles/1_covariance_profiles.nc
            active variables: *vars
            fraction of lost variance to restore multiplicatively: 0.5
            multiplicative coefficients atlas file:
              filepath:  testdata/dirac_spectralb_covariance_rescaling_1/multiplicative_rescaling_coeffs
            additive coefficients atlas file:  # Required by component #2
              filepath:  testdata/dirac_spectralb_covariance_rescaling_1/additive_rescaling_coeffs
              one file per task: true
    - weight:
        value: 1.0
      covariance:
       saber central block:
         saber block name: ID
       saber outer blocks:
       - saber block name: StdDev
         read:
           atlas file:  # Generated by component #1
             filepath: testdata/dirac_spectralb_covariance_rescaling_1/additive_rescaling_coeffs
             one file per task: true


dirac: &dirac
  lon:
  - 1
  - 1
  lat:
  - 1.0
  - 1.0
  level:
  - 1
  - 1
  variable:
  - mu
  - unbalanced_pressure_levels_minus_one

diagnostic points: *dirac

output dirac:
  mpi pattern: '%MPI%'
  filepath: testdata/dirac_spectralb_covariance_rescaling_1/%MPI%_dirac_%id%

covariance profile:
  output filepath: testdata/dirac_spectralb_covariance_rescaling_1/_MPI__covariance_profiles_%id%.nc

test:
  reference filename: testref/dirac_spectralb_covariance_rescaling_1.ref
