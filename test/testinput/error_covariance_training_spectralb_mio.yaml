# Calibration of the Moisture Incrementing Operator
geometry:
  function space: StructuredColumns
  grid:
    type: regular_gaussian
    N: 12
  groups:
  - variables:
    - air_pressure
    - air_pressure_levels_minus_one
    - air_temperature
    - cfeff
    - cleff
    - cloud_liquid_water_mixing_ratio_wrt_moist_air_and_condensed_water
    - cloud_ice_mixing_ratio_wrt_moist_air_and_condensed_water
    - dlsvpdT
    - exner
    - exner_levels_minus_one
    - height_above_mean_sea_level
    - ice_cloud_volume_fraction_in_atmosphere_layer
    - liquid_cloud_volume_fraction_in_atmosphere_layer
    - mu
    - muA
    - muH1
    - muRecipDeterminant
    - muRow1Column1
    - muRow1Column2
    - muRow2Column1
    - muRow2Column2
    - cloud_ice_mixing_ratio_wrt_dry_air
    - cloud_liquid_water_mixing_ratio_wrt_dry_air
    - rain_mixing_ratio_wrt_dry_air
    - total_water_mixing_ratio_wrt_dry_air
    - water_vapor_mixing_ratio_wrt_dry_air
    - potential_temperature
    - qrain
    - qsat
    - qt
    - rht
    - specific_humidity
    - svp
    levels: 70
  - variables:
    - air_pressure_levels
    - height_above_mean_sea_level_levels
    - hydrostatic_exner_levels
    - hydrostatic_pressure_levels
    levels: 71
  partitioner: ectrans
  halo: 1

increment variables: &inc_vars
- exner_levels_minus_one
- cloud_ice_mixing_ratio_wrt_moist_air_and_condensed_water
- cloud_liquid_water_mixing_ratio_wrt_moist_air_and_condensed_water
- potential_temperature
- specific_humidity

background error:
  covariance model: SABER
  ensemble pert:
    date: &date 2016-01-01T16:00:00Z
    members from template:
      pattern: '%MEM%'
      nmembers: 1
      template:
        date: *date
        filepath: testdata/randomization_sqrtspectralb_2/randomized_gauss_mb%MEM%
        variables: *inc_vars
  saber central block:
    saber block name: ID
    active variables:
    - exner_levels_minus_one
    - cloud_ice_mixing_ratio_wrt_moist_air_and_condensed_water
    - cloud_liquid_water_mixing_ratio_wrt_moist_air_and_condensed_water
    - potential_temperature
    - qt
    - specific_humidity
  saber outer blocks:
  - saber block name: mo_super_mio
    moisture incrementing operator file: testdata/MIO_coefficients.nc
    calibration:
      coefficient filling value: median
      output file: testdata/error_covariance_training_spectralb_mio/MIO_coefficients_new.nc

background:
  date: *date
  state variables:
  - air_pressure
  - air_pressure_levels_minus_one
  - air_temperature
  - cfeff
  - cleff
  - dlsvpdT
  - exner
  - exner_levels_minus_one
  - height_above_mean_sea_level
  - height_above_mean_sea_level_levels
  - ice_cloud_volume_fraction_in_atmosphere_layer
  - liquid_cloud_volume_fraction_in_atmosphere_layer
  - cloud_liquid_water_mixing_ratio_wrt_moist_air_and_condensed_water
  - cloud_ice_mixing_ratio_wrt_moist_air_and_condensed_water
  - mu
  - muA
  - muH1
  - muRecipDeterminant
  - muRow1Column1
  - muRow1Column2
  - muRow2Column1
  - muRow2Column2
  - cloud_ice_mixing_ratio_wrt_dry_air
  - cloud_liquid_water_mixing_ratio_wrt_dry_air
  - rain_mixing_ratio_wrt_dry_air
  - total_water_mixing_ratio_wrt_dry_air
  - water_vapor_mixing_ratio_wrt_dry_air
  - potential_temperature
  - qrain
  - qsat
  - qt
  - rht
  - specific_humidity
  - svp
  filepath: testdata/gauss_state

test:
  reference filename: testref/error_covariance_training_spectralb_mio.ref
